"use strict";var moheera=angular.module("moheera",["ui.bootstrap","ui.router","ngResource","authModule","homeModule","userModule","productModule","orderModule","cartModule"]);moheera.config(["$urlRouterProvider","$stateProvider",function(e,r){e.otherwise("notfound"),r.state("notfound",{url:"/notfound",templateUrl:"public/modules/config/view/notfound.config.view.html",controller:"errorConfigController"}).state("droppedIn",{url:"",templateUrl:"public/modules/home/view/index.home.view.html",controller:"indexHomeController"}).state("home",{url:"/",templateUrl:"public/modules/home/view/index.home.view.html",controller:"indexHomeController"}).state("contact",{url:"/contact",templateUrl:"public/modules/home/view/contact.home.view.html",controller:"indexHomeController"}).state("about",{url:"/about",templateUrl:"public/modules/home/view/about.home.view.html",controller:"indexHomeController"}).state("signin",{url:"/signin",templateUrl:"public/modules/auth/view/signin.auth.view.html",controller:"signinAuthController"}).state("signup",{url:"/signup",templateUrl:"public/modules/auth/view/signup.auth.view.html",controller:"signupAuthController"}).state("signout",{url:"/signout",controller:"signoutAuthController"}).state("profile",{url:"/profile",templateUrl:"public/modules/user/view/profile.user.view.html",controller:"profileUserControlller"}).state("profile.category",{url:"/product/category/:category",templateUrl:"public/modules/user/view/category.user.view.html",controller:"categoryUserController"}).state("profile.remove",{url:"/remove",templateUrl:"public/modules/user/view/remove.account.user.view.html",controller:"removeAccountUserController"}).state("profile.setting",{url:"/setting",templateUrl:"public/modules/user/view/setting.user.view.html",controller:"settingUserController"}).state("profile.userPassword",{url:"/account/password",templateUrl:"public/modules/user/view/change.password.user.view.html",controller:"changePasswordUserController"}).state("profile.orderDone",{url:"/order/done",templateUrl:"public/modules/order/view/done.order.view.html",controller:"allOrderController"}).state("profile.orderCreate",{url:"/order/create",templateUrl:"public/modules/order/view/create.order.view.html",controller:"createOrderController"}).state("profile.singleOrder",{url:"/product/:productId/order/:id/",templateUrl:"public/modules/order/view/single.order.view.html",controller:"singleOrderController"}).state("profile.order",{url:"/order",templateUrl:"public/modules/order/view/all.order.view.html",controller:"allOrderController"}).state("profile.addProduct",{url:"/product/add",templateUrl:"public/modules/product/view/add.product.view.html",controller:"addProductController"}).state("profile.editProduct",{url:"/product/:name/edit",templateUrl:"public/modules/product/view/edit.product.view.html",controller:"editProductController"}).state("profile.singleProduct",{url:"/product/:name",templateUrl:"public/modules/product/view/single.product.view.html",controller:"singleProductController"}).state("profile.cart",{url:"/cart",templateUrl:"public/modules/cart/view/all.cart.view.html",controller:"allCartController"}).state("user",{url:"/:userName",templateUrl:"public/modules/user/view/other.user.view.html",controller:"otherUserControlller"}).state("user.singleProduct",{url:"/:productName",templateUrl:"public/modules/product/view/other.single.product.view.html",controller:"otherSingleProductControlller"}).state("user.category",{url:"/product/category/:category",templateUrl:"public/modules/user/view/other.category.user.view.html",controller:"categoryUserController"})}]).run(["$rootScope",function(e){e.logged=!1,e.lastPage=""}]),angular.module("homeModule",[]),angular.module("authModule",[]),angular.module("cartModule",[]),angular.module("orderModule",[]),angular.module("userModule",[]),angular.module("productModule",[]),angular.module("moheera").controller("ModalInstanceConfigController",["$scope","$rootScope","$modalInstance",function(e,r,o){e.cancel=function(){o.dismiss("cancel")}}]),angular.module("moheera").controller("errorConfigController",["$scope",function(){}]),angular.module("moheera").controller("navMenu",["$rootScope","$scope","registerUserConfigFactory",function(e,r,o){r.navbarCollapsed=!1,r.$on("$stateChangeSuccess",function(){r.navbarCollapsed=!1}),e.$watch("logged",function(){e.logged?(r.user=o.getUser(),r.loggedLink=!0,r.notLoggedLink=!1):(r.loggedLink=!1,r.notLoggedLink=!0)})}]),angular.module("moheera").factory("registerUserConfigFactory",["$window","$rootScope","$q",function(e,r,o){var t={};return t.user=!1,t.readUserInfo=function(){return t.user=e.userInfo||!1},t.clearUserInfo=function(){r.logged=!1,r.lastPage="",t.user=e.userInfo=!1},t.setUser=function(o){t.user=e.userInfo=o||!1,t.user&&(r.logged=!0)},t.getUser=function(){var e=o.defer();return e.resolve(t.readUserInfo()),e.promise.then(function(e){e&&(t.user=e,r.logged=!0)}),t.user},t}]),angular.module("moheera").factory("requreLoginConfigFactory",["$modal","$rootScope","$location",function(e,r,o){return{open:function(t){r.lastPage=o.path(),t||(t=""),e.open({templateUrl:"public/modules/config/view/require.login.config.view.html",size:"md",controller:"ModalInstanceConfigController"})}}}]),angular.module("homeModule").controller("indexHomeController",["registerUserConfigFactory","$location","$scope",function(e,r,o){o.user=e.getUser(),o.user&&r.path("/profile")}]),angular.module("authModule").controller("signinAuthController",["registerUserConfigFactory","$scope","$http","$location","$rootScope",function(e,r,o,t,n){r.signIn=function(){o.post("/login",r.credentials).success(function(r){e.setUser(r),t.path(n.lastPage?n.lastPage:"/profile")}).error(function(e){r.error=e})}}]),angular.module("authModule").controller("signoutAuthController",["registerUserConfigFactory","$http","$state",function(e,r,o){r.get("logout").success(function(){e.clearUserInfo(),o.go("home",{},{reload:!0})})}]),angular.module("authModule").controller("signupAuthController",["registerUserConfigFactory","$scope","$location","connectAuthFactory",function(e,r,o,t){e.getUser()&&o.path("/profile"),r.signUp=function(){t.save(r.credentials,function(){o.path("/signin")},function(e){r.error=e.data.message})}}]),angular.module("authModule").factory("connectAuthFactory",["$resource",function(e){return e("/user/:id")}]),angular.module("cartModule").controller("allCartController",["$scope","$location","connectCartFactory","$state","registerUserConfigFactory",function(e,r,o,t,n){e.user=n.getUser(),o.query({action:"products"},function(r){e.cart=r}),e.onePlusQuantity=function(r){e.cart[r].quantity<20&&(e.cart[r].quantity++,o.update({product:e.cart[r]},function(){e.error=!1,e.user.cart=e.cart,n.setUser(e.user)},function(o){e.cart[r].quantity--,e.error=o.data.message}))},e.oneMinusQuantity=function(r){e.cart[r].quantity>=2&&(e.cart[r].quantity--,o.update({product:e.cart[r]},function(){e.error=!1,e.user.cart=e.cart,n.setUser(e.user)},function(o){e.cart[r].quantity++,e.error=o.data.message}))},e.removeCartProduct=function(r){o.remove({productId:e.cart[r].productId},function(){e.cart.splice(r,1),e.user.cart=e.cart})},e.goToOrder=function(){t.go("profile.orderCreate",{},{reload:!0})}}]),angular.module("cartModule").factory("connectCartFactory",["$resource",function(e){return e("/user/cart/:productId/:action",{productId:"@productId",action:"@action"},{update:{method:"PUT"}})}]),angular.module("orderModule").controller("allOrderController",["$scope","$location","registerUserConfigFactory","connectOrderFactory","$state","statusOrderFactory",function(e,r,o,t,n,c){e.user=o.getUser(),e.statusOptions=c.status,e.showStatus=function(){var e={};return e.status="pending"},t.query(function(r){e.orderInfo=r},function(r){e.error=r.data.message}),e.orderDetails=function(e,r){n.go("profile.singleOrder",{productId:e,id:r},{reload:!0})}}]),angular.module("orderModule").controller("createOrderController",["$scope","$location","connectOrderFactory","registerUserConfigFactory",function(e,r,o,t){e.user=t.getUser(),e.cart=e.user.cart,e.cartInfo=function(){var r=e.user.cart,o=0,t=0;return r.forEach(function(e){t+=e.price*e.quantity,o+=e.quantity}),{totalQuantity:o,totalPrice:t}},e.confirmOrder=function(){var n={mobilePhone:e.newOrder.mobilePhone,address:e.newOrder.address,remarks:e.newOrder.remarks,status:"pending"};o.save({info:n},function(){r.path("profile/order/done"),e.user.cart=[],t.setUser(e.user)},function(r){e.error=r.data.message})}}]),angular.module("orderModule").controller("singleOrderController",["$scope","$location","connectOrderFactory","$stateParams","statusOrderFactory","registerUserConfigFactory",function(e,r,o,t,n,c){e.user=c.getUser(),e.statusOptions=n.status,o.get({productId:t.productId,id:t.id},function(r){e.orderInfo=r.order,e.productInfo=r.product,e.oldStatus=angular.copy(r.order.status)},function(r){e.error=r.data.message}),e.updateOrder=function(){var r={status:e.orderInfo.status,statusHistory:{oldStatus:e.oldStatus,updateRemarks:e.updateRemarks}};o.update({productId:t.productId,id:t.id},r,function(r){e.updateRemarks="",e.success=r,e.error=!1,e.orderInfo=r.order,e.oldStatus=angular.copy(r.order.status)},function(r){e.error=r.data.message,e.success=!1})}}]),angular.module("orderModule").factory("connectOrderFactory",["$resource",function(e){return e("/product/:productId/order/:id/:name",{productId:"@productId",id:"@id",name:"@name"},{update:{method:"PUT"}})}]),angular.module("orderModule").factory("statusOrderFactory",[function(){return{status:["delivered","pending","processing","canceled"]}}]),angular.module("orderModule").filter("statusOrderFilter",[function(){return function(e,r){var o=[];if(r)for(var t=0;t<e.length;t++){var n=e[t];n.status==r&&o.push(n)}else o=e;return o}}]),angular.module("userModule").controller("categoryUserController",["connectProductFactory","$stateParams","$scope","registerUserConfigFactory",function(e,r,o,t){var n=t.getUser();e.query({userName:r.userName||n.name,action:"category",categoryName:r.category},function(e){o.productByCategory=e})}]),angular.module("userModule").controller("changePasswordUserController",["$scope","$location","connectUserFactory",function(e,r,o){e.changeUserPassword=function(){e.success=!1,e.error=!1;var r=new FormData;r.append("newPassword",e.userInfo.newPassword),r.append("currentPassword",e.userInfo.currentPassword),o.update({action:"password"},r,function(){e.success=!0,e.userInfo.newPassword="",e.userInfo.currentPassword="",e.userInfo.verifyPassword=""},function(r){e.error=r.data.message})},e.noMatch=function(){return e.userInfo.newPassword==e.userInfo.verifyPassword?!1:!0}}]),angular.module("userModule").controller("otherUserControlller",["registerUserConfigFactory","connectProductFactory","$location","$scope","$stateParams",function(e,r,o,t,n){var c=e.getUser();r.get({action:"all",getByName:n.userName},function(e){t.userProducts=e.product,t.userInfo=e.user[0],t.userInfo._id===c._id&&o.path("/profile"),t.banner=function(){return t.userInfo?t.userInfo.banner?"public/uploads/"+t.userInfo.banner:"public/modules/config/img/banner.jpg":void 0}},function(){o.path("/notfound")})}]),angular.module("userModule").controller("profileUserControlller",["registerUserConfigFactory","connectProductFactory","$location","$scope",function(e,r,o,t){t.userInfo=e.getUser(),t.userInfo||o.path("/signin"),t.banner=function(){return t.userInfo?t.userInfo.banner.length?"public/uploads/"+t.userInfo.banner:"public/modules/config/img/banner.jpg":void 0},r.get({action:"all",getByName:t.userInfo.name},function(e){t.userProducts=e.product})}]),angular.module("userModule").controller("removeAccountUserController",["$scope","$location","connectUserFactory",function(e,r,o){e.cancelRemove=function(){r.path("/profile")},e.confirmRemove=function(){o.remove(function(){r.path("/")},function(r){e.error=r.data.message})}}]),angular.module("userModule").controller("settingUserController",["$scope","$location","connectUserFactory",function(e,r,o){e.removeAccount=function(){r.path("/profile/remove")},e.updateAccount=function(){var r=new FormData;r.append("logo",document.getElementById("logo").files[0]),r.append("banner",document.getElementById("banner").files[0]),r.append("firstName",e.userInfo.firstName),r.append("lastName",e.userInfo.lastName),r.append("email",e.userInfo.email),r.append("mobilePhone",e.userInfo.mobilePhone),r.append("pageDesc",e.userInfo.pageDesc),o.update(r,function(){e.success=!0},function(r){e.error=r.data.message})}}]),angular.module("userModule").directive("sidebarUserDirective",["registerUserConfigFactory","$stateParams","connectProductFactory","$state",function(e,r,o){return{restrict:"A",templateUrl:"public/modules/user/view/sidebar.user.view.html",replace:!0,transclude:!0,scope:{product:"=sidebarUserDirective"},link:function(t,n){var c,u=[],a=e.getUser();t.profile=void 0==r.userName?"profile":r.userName,t.userName=void 0==r.userName?a.name:r.userName,t.$watch("product",function(e){e&&o.get({action:"category",userName:t.userName},function(e){t.user=e.user||a;var r=e.category;r&&(r.forEach(function(e){u.push({name:e,value:e,profile:t.profile})}),t.cats=u),c=t.user.logo?'<div class="row" style="background-color:#fff;padding-bottom:8%;">\n										<div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-xs-10 col-xs-offset-1 col-sm-8 col-sm-offset-2">\n											<a href="#/'+t.user.name+'">\n												<img style="margin-bottom:-2%;" class="img-responsive box-center" src="public/uploads/'+t.user.logo+'">\n											</a>\n										</div>\n									</div>':'<div class="row" style="background-color:#fff;padding-bottom:5%;padding-top:5%;">\n										<div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">\n											<a href="#/'+t.user.name+'">\n												<span class="glyphicon glyphicon-user img-responsive text-center" style="font-size:164px;color: #cccccc;" aria-hidden="true"></span>\n											</a>\n										</div>\n									</div>',n.parent().prepend(c)})}),t.isActive=function(e){return e==r.category?!0:"all"!=e||r.category?void 0:!0}}}}]),angular.module("userModule").factory("connectUserFactory",["$resource",function(e){return e("/user/:action/:byUserName",{name:"@byUserName",action:"@action"},{update:{method:"PUT",withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}})}]),angular.module("productModule").controller("addProductController",["$scope","$location","connectProductFactory","categoryProductFactory","$state",function(e,r,o,t,n){e.categoryOptions=t,e.addProduct=function(){var r=new FormData;r.append("image1",document.getElementById("image1").files[0]),r.append("image2",document.getElementById("image2").files[0]),r.append("image3",document.getElementById("image3").files[0]),r.append("image4",document.getElementById("image4").files[0]),r.append("name",e.newProduct.name),r.append("price",e.newProduct.price),r.append("quantity",e.newProduct.quantity),r.append("category",e.newProduct.category),r.append("desc",e.newProduct.desc),o.save(r,function(){n.go("profile",{},{reload:!0})},function(r){console.log(r),e.error=r.data.message})},e.count=function(){for(var e=[],r=1;20>=r;r++)e.push(r);return e}}]),angular.module("productModule").controller("editProductController",["$scope","$stateParams","$location","connectProductFactory","categoryProductFactory",function(e,r,o,t,n){e.categoryOptions=n,t.get({getByName:r.name},function(r){e.productInfo=r},function(){o.path("/notfound")}),e.updateProductInfo=function(){var r=new FormData;r.append("image1",document.getElementById("image1").files[0]),r.append("image2",document.getElementById("image2").files[0]),r.append("image3",document.getElementById("image3").files[0]),r.append("image4",document.getElementById("image4").files[0]),r.append("name",e.productInfo.name),r.append("price",e.productInfo.price),r.append("quantity",e.productInfo.quantity),r.append("category",e.productInfo.category),r.append("desc",e.productInfo.desc),t.update({id:e.productInfo._id},r,function(){e.error=!1,e.success=!0},function(r){e.success=!1,e.error=r.data.message})}}]),angular.module("productModule").controller("otherSingleProductControlller",["$scope","$stateParams","connectProductFactory","$location","connectCommentProductFactory","registerUserConfigFactory","connectCartFactory","$state","requreLoginConfigFactory",function(e,r,o,t,n,c,u,a,l){e.user=c.getUser(),e.productName=r.name,o.get({getByName:r.productName},function(r){e.product=r},function(){}),e.showRemoveProductBox=function(){e.removeProductBox=!0},e.removeProduct=function(){o.remove({id:e.product._id},function(){a.go("profile",{},{reload:!0})},function(r){e.error=r.data.message})},e.cancelRemoveProduct=function(){e.removeProductBox=!1},e.addComment=function(){e.newComment&&n.save({id:e.product._id},{content:e.newComment},function(r){e.product.comment.push(r),e.newComment=""},function(r){403==r.status?l.open("comment"):e.error=r.data.message})},e.removeComment=function(r,o,t){n.remove({commentId:o,id:t},function(){e.product.comment.splice(r,1)},function(r){e.error=r.data.message})}}]),angular.module("productModule").controller("singleProductController",["$scope","$stateParams","connectProductFactory","$location","connectCommentProductFactory","registerUserConfigFactory","connectCartFactory","$state","requreLoginConfigFactory",function(e,r,o,t,n,c,u,a,l){e.user=c.getUser(),e.productName=r.name,o.get({getByName:e.productName},function(r){e.product=r},function(){t.path("/notfound")}),e.showRemoveProductBox=function(){e.removeProductBox=!0},e.removeProduct=function(){o.remove({id:e.product._id},function(){a.go("profile",{},{reload:!0})},function(r){e.error=r.data.message})},e.cancelRemoveProduct=function(){e.removeProductBox=!1},e.addComment=function(){e.newComment&&n.save({id:e.product._id},{content:e.newComment},function(r){e.product.comment.push(r),e.newComment=""},function(r){403==r.status?l.open("comment"):e.error=r.data.message})},e.removeComment=function(r,o,t){n.remove({commentId:o,id:t},function(){e.product.comment.splice(r,1)},function(r){e.error=r.data.message})}}]),angular.module("productModule").factory("categoryProductFactory",[function(){return["men","women","kid"]}]),angular.module("userModule").factory("connectCommentProductFactory",["$resource",function(e){return e("product/:id/comment/:commentId",{id:"@id",commentId:"@commentId"})}]),angular.module("productModule").factory("connectHeartProductFactory",["$resource",function(e){return e("product/:productId/heart/:heartId",{productId:"@productId",heartId:"@heartId"})}]),angular.module("productModule").factory("connectProductFactory",["$resource",function(e){return e("/product/:userName/:action/:id/:getByName/:categoryName",{id:"@_id",action:"@action",categoryName:"@categoryName",getByName:"@getByName",userName:"@userName"},{update:{method:"PUT",withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity},save:{method:"POST",withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}})}]),angular.module("productModule").directive("cartIconProductDirective",["connectCartFactory","registerUserConfigFactory","requreLoginConfigFactory",function(e,r,o){return{restrict:"A",templateUrl:"public/modules/product/view/cart.icon.product.view.html",replace:!0,transclude:!0,scope:{product:"=cartIconProductDirective"},link:function(t){t.user=r.getUser(),t.$watch("product",function(e){var r=function(){if(e&&t.user){if(t.user.cart.length>0)for(var r=t.user.cart,o=0;o<=r.length;o++)if(r[o]&&r[o].productId==e._id)return!0;return!1}return!1};t.isChecked=r()}),t.addToCart=function(n){0==t.isChecked&&n.quantity>=1?e.save({productId:n._id,product:n},function(e){t.user.cart=e.cart,r.setUser(t.user),t.isChecked=!0},function(e){403==e.status&&o.open("cart")}):e.remove({productId:n._id},function(e){t.user.cart=e.cart,r.setUser(t.user),t.isChecked=!1})}}}}]),angular.module("productModule").directive("commentIconProductDirective",["registerUserConfigFactory",function(e){return{restrict:"A",templateUrl:"public/modules/product/view/comment.icon.product.view.html",replace:!0,transclude:!0,scope:{product:"=commentIconProductDirective"},link:function(r){var o=e.getUser();r.$watch("product",function(e){var t=function(){if(e){if(e.comment.length>0)for(var r=e.comment,t=0;t<r.length;t++)if(r[t].author[0]._id==o._id)return!0;return!1}return!1};r.isChecked=t()}),r.addComment=function(){$scope.newComment&&connectCommentProductFactory.save({id:$scope.product._id},{content:$scope.newComment},function(e){$scope.product.comment.push(e),$scope.newComment=""},function(e){$scope.error=e.data.message})},r.removeComment=function(e,r,o){connectCommentProductFactory.remove({commentId:r,id:o},function(){$scope.product.comment.splice(e,1)},function(e){$scope.error=e.data.message})}}}}]),angular.module("productModule").directive("heartIconProductDirective",["registerUserConfigFactory","connectHeartProductFactory","requreLoginConfigFactory",function(e,r,o){return{restrict:"A",templateUrl:"public/modules/product/view/heart.icon.product.view.html",replace:!0,transclude:!0,scope:{product:"=heartIconProductDirective"},link:function(t){var n=e.getUser();t.$watch("product",function(e){var r=function(){if(e){if(e.heart.length>0)for(var r=e.heart,o=0;o<=r.length;o++)if(r[o])for(var t=0;t<r[o].user.length;t++)if(r[o].user[t]._id===n._id)return!0;return!1}return!1};t.isChecked=r()}),t.heartProduct=function(e){0==t.isChecked?r.save({productId:e},function(e){t.product.heart=e.heart,t.isChecked=!0},function(e){403==e.status&&o.open("heart")}):r.remove({productId:e},function(e){t.product.heart=e.heart,t.isChecked=!1})}}}}]),angular.module("productModule").directive("productBoxProductDirective",["registerUserConfigFactory","$stateParams","$state",function(e){return{restrict:"A",templateUrl:"public/modules/product/view/product.box.product.view.html",replace:!0,transclude:!0,scope:{product:"=productBoxProductDirective"},link:function(r){var o=e.getUser();r.$watch("product",function(e){e&&(r.viewImageLink="public/uploads/"+e.image1,r.highlightImage=1,r.productLink=o._id==e.user?"#/profile/product/"+e.name:"#/"+e.userName+"/"+e.name,r.viewImage=function(o){switch(o){case"1":r.viewImageLink="public/uploads/"+e.image1,r.highlightImage=1;break;case"2":r.viewImageLink="public/uploads/"+e.image2,r.highlightImage=2;break;case"3":r.viewImageLink="public/uploads/"+e.image3,r.highlightImage=3;break;case"4":r.viewImageLink="public/uploads/"+e.image4,r.highlightImage=4;break;default:r.viewImageLink="public/uploads/"+e.image1,r.highlightImage=1}})})}}}]);