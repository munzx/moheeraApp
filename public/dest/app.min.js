"use strict";angular.module("cartModule",[]),angular.module("authModule",[]);var moheera=angular.module("moheera",["ui.bootstrap","ui.router","angularChart","ngResource","authModule","homeModule","userModule","productModule","orderModule","cartModule","reportModule"]);moheera.config(["$urlRouterProvider","$stateProvider",function(e,r){e.otherwise("notfound"),r.state("notfound",{url:"/notfound",templateUrl:"public/modules/config/view/notfound.config.view.html",controller:"errorConfigController"}).state("home",{url:"",templateUrl:"public/modules/home/view/index.home.view.html",controller:"indexHomeController"}).state("contact",{url:"/contact",templateUrl:"public/modules/home/view/contact.home.view.html",controller:"indexHomeController"}).state("about",{url:"/about",templateUrl:"public/modules/home/view/about.home.view.html",controller:"indexHomeController"}).state("signin",{url:"/signin",templateUrl:"public/modules/auth/view/signin.auth.view.html",controller:"signinAuthController"}).state("signup",{url:"/signup",templateUrl:"public/modules/auth/view/signup.auth.view.html",controller:"signupAuthController"}).state("signout",{url:"signout",controller:"signoutAuthController"}).state("profile",{url:"/profile",templateUrl:"public/modules/user/view/profile.user.view.html",controller:"profileUserControlller"}).state("profile.remove",{url:"/remove",templateUrl:"public/modules/user/view/remove.account.user.view.html",controller:"removeAccountUserController"}).state("profile.setting",{url:"/setting",templateUrl:"public/modules/user/view/setting.user.view.html",controller:"settingUserController"}).state("profile.userPassword",{url:"/account/password",templateUrl:"public/modules/user/view/change.password.user.view.html",controller:"changePasswordUserController"}).state("profile.report",{url:"/report",templateUrl:"public/modules/report/view/all.report.view.html",controller:"allReportController"}).state("profile.orderDone",{url:"/order/done",templateUrl:"public/modules/order/view/done.order.view.html",controller:"allOrderController"}).state("profile.orderCreate",{url:"/order/create",templateUrl:"public/modules/order/view/create.order.view.html",controller:"createOrderController"}).state("profile.singleOrder",{url:"/product/:productId/order/:id/",templateUrl:"public/modules/order/view/single.order.view.html",controller:"singleOrderController"}).state("profile.order",{url:"/order",templateUrl:"public/modules/order/view/all.order.view.html",controller:"allOrderController"}).state("profile.addProduct",{url:"/product/add",templateUrl:"public/modules/product/view/add.product.view.html",controller:"addProductController"}).state("profile.editProduct",{url:"/product/:name/edit",templateUrl:"public/modules/product/view/edit.product.view.html",controller:"editProductController"}).state("profile.singleProduct",{url:"/product/:name",templateUrl:"public/modules/product/view/single.product.view.html",controller:"singleProductController"}).state("profile.cart",{url:"/cart",templateUrl:"public/modules/cart/view/all.cart.view.html",controller:"allCartController"}).state("user",{url:"/:id",templateUrl:"public/modules/user/view/profile.user.view.html",controller:"profileUserControlller"}).state("user.singleProduct",{url:"/:userId/productId",templateUrl:"public/modules/user/view/profile.user.view.html",controller:"profileUserControlller"})}]).run(["$rootScope",function(e){e.logged=!1}]),angular.module("homeModule",[]),angular.module("orderModule",[]),angular.module("productModule",[]),angular.module("reportModule",[]),angular.module("userModule",[]),angular.module("cartModule").controller("allCartController",["$scope","$location","connectCartFactory","$state","registerUserConfigFactory",function(e,r,o,t,n){e.user=n.getUser(),o.query({action:"products"},function(r){e.cart=r}),e.onePlusQuantity=function(r){e.cart[r].quantity<20&&(e.cart[r].quantity++,o.update({product:e.cart[r]},function(){e.user.cart=e.cart,n.setUser(e.user)}))},e.oneMinusQuantity=function(r){e.cart[r].quantity>=2&&(e.cart[r].quantity--,o.update({product:e.cart[r]},function(){e.user.cart=e.cart,n.setUser(e.user)}))},e.removeCartProduct=function(r){o.remove({productId:e.cart[r].productId},function(){e.cart.splice(r,1)})},e.goToOrder=function(){t.go("profile.orderCreate",{},{reload:!0})}}]),angular.module("cartModule").factory("connectCartFactory",["$resource",function(e){return e("/user/cart/:productId/:action",{productId:"@productId",action:"@action"},{update:{method:"PUT"}})}]),angular.module("authModule").controller("signinAuthController",["registerUserConfigFactory","$scope","$http","$location",function(e,r,o,t){r.signIn=function(){o.post("/login",r.credentials).success(function(r){e.setUser(r),t.path("/profile")}).error(function(e){r.error=e})}}]),angular.module("authModule").controller("signoutAuthController",["registerUserConfigFactory","$http","$location",function(e,r,o){r.get("/logout").success(function(){e.clearUserInfo(),o.path("/home")})}]),angular.module("authModule").controller("signupAuthController",["registerUserConfigFactory","$scope","$location","connectAuthFactory",function(e,r,o,t){e.getUser()&&o.path("/profile"),r.signUp=function(){t.save(r.credentials,function(){o.path("/signin")},function(e){r.error=e.data.message})}}]),angular.module("authModule").factory("connectAuthFactory",["$resource",function(e){return e("/user/:id")}]),angular.module("moheera").controller("errorConfigController",["$scope",function(){}]),angular.module("moheera").controller("navMenu",["$rootScope","$scope",function(e,r){r.navbarCollapsed=!1,r.$on("$stateChangeSuccess",function(){r.navbarCollapsed=!1}),e.$watch("logged",function(){e.logged?(r.loggedLink=!0,r.notLoggedLink=!1):(r.loggedLink=!1,r.notLoggedLink=!0)})}]),angular.module("moheera").factory("registerUserConfigFactory",["$window","$rootScope","$q",function(e,r,o){var t={};return t.user=!1,t.readUserInfo=function(){return t.user=e.userInfo||!1},t.clearUserInfo=function(){r.logged=!1,t.user=e.userInfo=!1},t.setUser=function(o){t.user=e.userInfo=o||!1,t.user&&(r.logged=!0)},t.getUser=function(){var e=o.defer();return e.resolve(t.readUserInfo()),e.promise.then(function(e){e&&(t.user=e,r.logged=!0)}),t.user},t}]),angular.module("homeModule").controller("indexHomeController",["registerUserConfigFactory","$location","$scope",function(e,r,o){o.user=e.getUser(),o.user&&r.path("/profile")}]),angular.module("orderModule").controller("allOrderController",["$scope","$location","registerUserConfigFactory","connectOrderFactory","$state","statusOrderFactory",function(e,r,o,t,n,u){e.user=o.getUser(),e.statusOptions=u.status,e.showStatus=function(){var e={};return e.status="pending"},t.query(function(r){e.orderInfo=r},function(r){e.error=r.data.message}),e.orderDetails=function(e,r){n.go("profile.singleOrder",{productId:e,id:r},{reload:!0})}}]),angular.module("orderModule").controller("createOrderController",["$scope","$location","connectOrderFactory","registerUserConfigFactory",function(e,r,o,t){e.user=t.getUser(),e.cart=e.user.cart,e.cartInfo=function(){var r=e.user.cart,o=0,t=0;return r.forEach(function(e){t+=e.price*e.quantity,o+=e.quantity}),{totalQuantity:o,totalPrice:t}},e.confirmOrder=function(){var n={mobilePhone:e.newOrder.mobilePhone,address:e.newOrder.address,remarks:e.newOrder.remarks,status:"pending"};o.save({info:n},function(){r.path("profile/order/done"),e.user.cart=[],t.setUser(e.user)},function(r){e.error=r.data.message})}}]),angular.module("orderModule").controller("singleOrderController",["$scope","$location","connectOrderFactory","$stateParams","statusOrderFactory",function(e,r,o,t,n){e.statusOptions=n.status,o.get({productId:t.productId,id:t.id},function(r){e.orderInfo=r.order,e.productInfo=r.product,e.oldStatus=r.order.status},function(r){e.error=r.data.message}),e.updateOrder=function(){var r={status:e.orderInfo.status,statusHistory:{oldStatus:e.oldStatus,updateRemarks:e.updateRemarks}};o.update({productId:t.productId,id:t.id},r,function(r){e.updateRemarks="",e.success=r},function(r){e.error=r.data.message})}}]),angular.module("orderModule").factory("connectOrderFactory",["$resource",function(e){return e("/product/:productId/order/:id/:name",{productId:"@productId",id:"@id",name:"@name"},{update:{method:"PUT"}})}]),angular.module("orderModule").factory("statusOrderFactory",[function(){return{status:["delivered","pending","processing","canceled"]}}]),angular.module("orderModule").filter("statusOrderFilter",[function(){return function(e,r){var o=[];if(r)for(var t=0;t<e.length;t++){var n=e[t];n.status==r&&o.push(n)}else o=e;return o}}]),angular.module("productModule").controller("addProductController",["$scope","$location","connectProductFactory","categoryProductFactory","$state",function(e,r,o,t,n){e.categoryOptions=t,e.addProduct=function(){o.save(e.newProduct,function(){n.go("profile",{},{reload:!0})},function(r){console.log(r),e.error=r.data.message})},e.count=function(){for(var e,r=1;20>r;r++)e[r]=r;return e}}]),angular.module("productModule").controller("editProductController",["$scope","$stateParams","$location","connectProductFactory","categoryProductFactory",function(e,r,o,t,n){e.categoryOptions=n,t.get({getByName:r.name},function(r){e.productInfo=r},function(){o.path("/notfound")}),e.updateProductInfo=function(){t.update(e.productInfo,function(){e.error=!1,e.success=!0},function(r){e.success=!1,e.error=r.data.message})}}]),angular.module("productModule").controller("singleProductController",["$scope","$stateParams","connectProductFactory","$location","connectCommentProductFactory","registerUserConfigFactory","connectHeartProductFactory","connectCartFactory","$state",function(e,r,o,t,n,u,c,a,l){e.user=u.getUser(),e.productName=r.name,o.get({getByName:e.productName},function(r){e.product=r,e.isHearted=function(){return r.heart.length>0&&r.heart[0].user[0]._id==e.user._id?!0:!1},e.isInCart=function(){if(e.user.cart.length>0)for(var o=0;o<e.user.cart.length;o++)if(e.user.cart[o].productId==r._id)return!0;return!1}},function(){t.path("/notfound")}),e.showRemoveProductBox=function(){e.removeProductBox=!0},e.removeProduct=function(){o.remove({id:e.product._id},function(){l.go("profile",{},{reload:!0})},function(r){e.error=r.data.message})},e.cancelRemoveProduct=function(){e.removeProductBox=!1},e.addComment=function(){e.newComment&&n.save({id:e.product._id},{content:e.newComment},function(r){e.product.comment.push(r),e.newComment=""},function(r){e.error=r.data.message})},e.removeComment=function(r,o,t){n.remove({commentId:o,id:t},function(){e.product.comment.splice(r,1)},function(r){e.error=r.data.message})},e.heartProduct=function(r){0==e.isHearted()?c.save({productId:r},function(r){e.product.heart=r.heart}):c.remove({productId:r},function(r){e.product.heart=r.heart})},e.addToCart=function(r){0==e.isInCart()&&r.quantity>=1?a.save({productId:r._id,product:r},function(r){e.user.cart=r.cart,console.log(r.cart)}):a.remove({productId:r._id},function(r){e.user.cart=r.cart,console.log(r.cart)})}}]),angular.module("productModule").factory("categoryProductFactory",[function(){return["men","women","kid"]}]),angular.module("userModule").factory("connectCommentProductFactory",["$resource",function(e){return e("product/:id/comment/:commentId",{id:"@id",commentId:"@commentId"})}]),angular.module("productModule").factory("connectHeartProductFactory",["$resource",function(e){return e("product/:productId/heart/:heartId",{productId:"@productId",heartId:"@heartId"})}]),angular.module("productModule").factory("connectProductFactory",["$resource",function(e){return e("/product/:id/:getByName",{id:"@_id",getByName:"@getByName"},{update:{method:"PUT"}})}]),angular.module("reportModule").controller("allReportController",["$scope","$location",function(e){e.productView={dataset:[{day:"2013-01-02_00:00:00",sales:13461.295202,income:12365.053},{day:"2014-01-02_00:00:00",sales:1346.202,income:1235.3},{day:"2015-01-02_00:00:00",sales:161.295202,income:1365.053}],schema:{day:{type:"datetime",format:"%Y-%m-%d_%H:%M:%S",name:"Date"}},options:{rows:[{key:"income",type:"bar"},{key:"sales"}],xAxis:{key:"day",displayFormat:"%Y-%m-%d %H:%M:%S"}}},e.productSaleByCategory={dataset:[{day:"2013-01-02_00:00:00",sales:13461.295202,income:12365.053},{day:"2014-01-02_00:00:00",sales:1346.202,income:1235.3},{day:"2015-01-02_00:00:00",sales:161.295202,income:1365.053}],schema:{day:{type:"datetime",format:"%Y-%m-%d_%H:%M:%S",name:"Date"}},options:{rows:[{key:"income",type:"pie"},{key:"sales"}],xAxis:{key:"day",displayFormat:"%Y-%m-%d %H:%M:%S"}}}}]),angular.module("userModule").controller("changePasswordUserController",["$scope","$location","connectUserFactory",function(e,r,o){e.changeUserPassword=function(){e.success=!1,e.error=!1,o.update({action:"password"},{newPassword:e.userInfo.newPassword,currentPassword:e.userInfo.currentPassword},function(){e.success=!0,e.userInfo.newPassword="",e.userInfo.currentPassword="",e.userInfo.verifyPassword=""},function(r){e.error=r.data.message})},e.noMatch=function(){return e.userInfo.newPassword==e.userInfo.verifyPassword?!1:!0}}]),angular.module("userModule").controller("profileUserControlller",["registerUserConfigFactory","connectProductFactory","$location","$scope",function(e,r,o,t){t.userInfo=e.getUser(),t.userInfo||o.path("/signin"),r.query(function(e){t.userProducts=e})}]),angular.module("userModule").controller("removeAccountUserController",["$scope","$location","connectUserFactory",function(e,r,o){e.cancelRemove=function(){r.path("/profile")},e.confirmRemove=function(){o.remove(function(){r.path("/")},function(r){e.error=r.data.message})}}]),angular.module("userModule").controller("settingUserController",["$scope","$location","connectUserFactory",function(e,r,o){e.removeAccount=function(){r.path("/profile/remove")},e.updateAccount=function(){o.update(e.userInfo,function(){e.success=!0},function(r){e.error=r.data.message})}}]),angular.module("userModule").factory("connectUserFactory",["$resource",function(e){return e("/user/:action/:byUserName",{name:"@byUserName",action:"@action"},{update:{method:"PUT"}})}]);